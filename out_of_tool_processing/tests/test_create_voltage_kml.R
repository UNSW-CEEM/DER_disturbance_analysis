testthat::context("Test creating voltage KML function.")

test_that("Test creating voltage KML", {
  data <- read.csv("voltage.csv", sep=",")
  expected_result = paste(
    c(
      "<?xml version=\"1.0\" encoding=\"UTF-8\"?>",
      "<kml xmlns=\"http://www.opengis.net/kml/2.2\">",
      "  <Document>",
      "    <name>Manual pu voltages</name>",
      "    <Style id=\"110kV\">",
      "      <LabelStyle>",
      "        <color>ff0000ff</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"132kV\">",
      "      <LabelStyle>",
      "        <color>ff0000ff</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"275kV\">",
      "      <LabelStyle>",
      "        <color>ffff00aa</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"66kV\">",
      "      <LabelStyle>",
      "        <color>ff1872cc</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"33kV\">",
      "      <LabelStyle>",
      "        <color>ff00aa00</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"22kV\">",
      "      <LabelStyle>",
      "        <color>ffffaa55</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"11kV\">",
      "      <LabelStyle>",
      "        <color>ffffaa55</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"220kV\">",
      "      <LabelStyle>",
      "        <color>ffff0000</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"330kV\">",
      "      <LabelStyle>",
      "        <color>ff00aaff</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"400kV\">",
      "      <LabelStyle>",
      "        <color>ffffaa55</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Style id=\"500kV\">",
      "      <LabelStyle>",
      "        <color>ff00ffff</color>",
      "        <scale>1.7</scale>",
      "      </LabelStyle>",
      "      <IconStyle>",
      "        <Icon/>",
      "      </IconStyle>",
      "    </Style>",
      "    <Placemark>",
      "      <name>500</name>",
      "      <description>Central Label</description>",
      "      <styleUrl>#500kV</styleUrl>",
      "      <Point>",
      "        <coordinates>151.29,-33.86</coordinates>",
      "      </Point>",
      "    </Placemark>",
      "    <Placemark>",
      "      <name>120</name>",
      "      <description>South West Sydney</description>",
      "      <styleUrl>#120kV</styleUrl>",
      "      <Point>",
      "        <coordinates>151.09,-33.96</coordinates>",
      "      </Point>",
      "    </Placemark>",
      "  </Document>",
      "</kml>"
    ),
    collapse="\n"
  )
  result <- create_voltage_kml(data)
  testthat::expect_equivalent(result, expected_result)
})
